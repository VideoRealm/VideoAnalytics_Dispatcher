# VideoAnalytics_Dispatcher
Dispatcher feature code for a [ultimately censored] app - just another bit of trash on Github
### Диспетчер потоков
#### Функции
1.	Установление ассоциации между входными потоками и доступными серверами аналитики;
2.	Фиксация назначений входных потоков на серверы аналитики в виде записей в выделенной таблице БД;
3.	Передача идентификационных данных серверов аналитики по запросам медиасервера.

Рис. 1. Схема установления ассоциации "сервер (аналитики) - видеокамера" через диспетчер потоков.
<p align="center">
  <img src="https://user-images.githubusercontent.com/55311053/80406167-ecbc8700-88c3-11ea-866e-2251c7519ce2.jpg" />
</p>
<br/>
<em>Пояснения к визуализации</em>
<ol>
<li>Администратор вносит инициализирующие данные новой камеры в таблицу БД устройств;</li>
<li>Контроллер БД сообщает диспетчеру о появлении новой камеры с неустановленным серверным компонентом ассоциации</li>    
<li>Сервер диспетчеризации, определяя наличие в таблице камер новых записей без указания ассоциированных хостов, назначает хост обработки потока согласно одному из двух допустимых сценариев:<br/>
1)	Оценивает текущий уровень нагрузки на серверы обработки для определения хостов с малым числом потоков и, при обнаружении подходящего узла, устанавливает за ним получение видео с камеры;<br/>
2)	Назначает сервер-исполнитель путём реализации алгоритма случайного выбора (round robin).<br/>
Дополнительной возможностью установления связи обработчика и камеры является получение диспетчером сообщения, инициированного свободным сервером обработки и определяющего его готовность к приёму потока данных. В этом случае процедура выбора сервера-обработчика осуществляется в упрощённом формате и не требует проведения мониторинга для оценки загрузки узлов аналитического кластера;<br/>
<li>Сервер диспетчеризации фиксирует результаты выбора обработчика путём внесения новой записи в таблицу ассоциаций БД.</li>
<li>Назначенный сервер использует информацию о сетевом адресе камеры для установки соединения и передачи потока, запрошенного медиасервером.</li>
</ol>  


Рис. 2. Схема определения базовых классов (not match, but tribute to UML class diagram).<br/>
![allegedClasses (2)](https://user-images.githubusercontent.com/55311053/80410118-58a1ee00-88ca-11ea-870e-07491dda0dd3.jpg)
<br/><br/><br/>

Рис. 3. Схема определения программных интерфейсов.<br/>
![controller_db](https://user-images.githubusercontent.com/55311053/80387445-f1277680-88a8-11ea-8e96-ada1f01def62.jpg)

Таблица 1. Состав и назначение функций API контроллера.
| Функция | Назначение|
|---|---|
| findAllServers | получение данных о всех действующих серверах аналитики |
| findAllCameras | получение данных о всех действующих видеокамерах |
| findAllPairs | получение данных о всех действующих ассоциациях "видеокамера - сервер (аналитики)" |
| findServerByCamId | возврат данных о сервере аналитики по ID ассоциированной видеокамеры |
| findCamerasByServerId | возврат данных о всех действующих камерах, ассоциированных с конкретным сервером |
| runRoundRobin | запуск процедуры случайного выбора сервера |
| bindCameraWithServer | установление ассоциации "видеокамера - сервер" с фиксацией изменений в БД |
| unbindCamera | отмена ассоциации видеокамеры с фиксацией изменений в БД |
<p></p>
<strong>Проработка технологического стека</strong> 

<br/>
&nbsp;&nbsp;&nbsp; Факторы оптимальности текущей структуры стека:<br/>
